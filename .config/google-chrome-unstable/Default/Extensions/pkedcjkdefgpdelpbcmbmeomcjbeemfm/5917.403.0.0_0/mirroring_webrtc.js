'use strict';var rZ={TAB:0,cg:1,Zi:2},sZ=function(a){ai("MediaRouter.WebRtc.Start.Success",a,rZ)};var wZ=function(a,b){Ri.call(this,b);this.u=a;this.a=new Nc;this.j=sp(b.id);this.h=new Nc;this.v=!1;this.g=null;this.w=!1;this.m=this.f=null;tZ(this);uZ(this);vZ(this,new Xi("GET_TURN_CREDENTIALS"))};ka(wZ,Ri);wZ.prototype.start=function(a){var b=this;return this.a.a.then(function(c){if(c.b)return Promise.reject(new di("Mirroring already started"));if(b.g)return Promise.reject(new di("Session permanently stopped"));b.f=new Rh("MediaRouter.WebRtc.Session.Launch");c.a.addStream(a);c.start();return b.h.a})};
wZ.prototype.stop=function(){var a=this;Oc(this.h,new di("Session stop requested."));this.m&&(this.m.a(),this.m=null);if(this.g)return this.g;this.w=this.v=!1;this.f=null;return this.g=this.a.a.then(function(a){a.stop()}).then(function(){return a.j.pa()}).catch(function(b){a.j.pa();throw b;})};
var tZ=function(a){a.j.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.a.resolve(new bj(a.b.id,b.data.credentials));break;case "ANSWER":a.a.a.then(function(a){jj(a,b.data)});break;case "KNOCK_ANSWER":a.w=!0;a.a.a.then(function(a){jj(a,b.data)});break;case "STOP":Oc(a.h,new di("Stop signal received"));a.stop();break;default:throw new di("Unknown message type: "+b.type);}}},uZ=function(a){a.a.a.then(function(b){fj(b,function(b){vZ(a,new Xi("OFFER",
new Zi(b,a.u,$i)))});gj(b,function(b){vZ(a,Yi(b))});cj(b,function(){a.v=!0;vZ(a,new Xi("SESSION_START_SUCCESS"));!a.w&&a.f&&a.f.a();a.f=null;a.m=new Xh("MediaRouter.WebRtc.Session.Length");a.h.resolve(a)});ej(b,function(){vZ(a,new Xi("SESSION_END"))});dj(b,function(b){a.v||a.h.b(b);vZ(a,new Xi("SESSION_FAILURE"))})})},vZ=function(a,b){a.j.sendMessage(b,xZ)},xZ={channelType:"cloud"};var yZ=function(){Gi.call(this,"webrtc")};ka(yZ,Gi);h=yZ.prototype;h.ae=function(a,b){return new wZ(a,b)};h.Ee=function(){sZ(0)};h.Ae=function(){sZ(1)};h.Gf=function(){sZ(2)};h.Be=function(){$h("MediaRouter.WebRtc.Session.End")};h.Ce=function(a){ai("MediaRouter.WebRtc.Start.Failure",a,ci)};h.De=function(){$h("MediaRouter.WebRtc.Stream.End")};var zZ=new yZ;Ei("mr.mirror.webrtc.WebRtcService",zZ);
